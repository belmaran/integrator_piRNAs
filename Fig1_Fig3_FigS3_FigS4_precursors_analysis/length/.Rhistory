motifdep_piRNA_precursors
motifdep_piRNA_precursors_data_summary<-lapply(motifdep_piRNA_precursors_fig1,function(df){
number_seqs<-aggregate(df[,"V12"],by=list(df[,"V12"]),FUN=length)
median_length<-aggregate(df[,"V4"],by=list(df[,"V12"]),FUN=median)
mean_length<-aggregate(df[,"V4"],by=list(df[,"V12"]),FUN=mean)
number_reads<-aggregate(df[,"x"],by=list(df[,"V12"]),FUN=sum)
df_uncol<-df[rep(row.names(df), df$x),]
median_length_numreads<-aggregate(df_uncol[,"V4"],by=list(df_uncol[,"V12"]),FUN=median)
mean_length_numreads<-aggregate(df_uncol[,"V4"],by=list(df_uncol[,"V12"]),FUN=mean)
merged<-data.frame(number_seqs$x,
median_length$x,
mean_length$x,
number_reads$x,
median_length_numreads$x,
mean_length_numreads$x)
colnames(merged)<-c("number_seqs","median_length","mean_length","number_reads","median_length_numreads","mean_length_numreads")
rownames(merged)<-number_seqs$Group.1
return(merged)
})
motifdep_piRNA_precursors_fig1<-list(motifdep_piRNA_precursors[[7]],rbind(motifdep_piRNA_precursors[[8]],motifdep_piRNA_precursors[[9]]))
names_fig1<-c("N2_EV_total","N2_ints11_total")
motifdep_piRNA_precursors_fig1[[1]]
N2_EV_np<-rbind(motifdep_piRNA_precursors[[14]],motifdep_piRNA_precursors[[22]])
N2_EV_np<-aggregate(N2_EV_np[,"V6"],by=N2_EV_np[c("V1","V2","V3","V4","V5","V12")],FUN=sum)
N2_ints11_np<-rbind(motifdep_piRNA_precursors[[15]],motifdep_piRNA_precursors[[23]])
N2_ints11_np<-aggregate(N2_ints11_np[,"V6"],by=N2_ints11_np[c("V1","V2","V3","V4","V5","V12")],FUN=sum)
tfiis_EV_np<-rbind(motifdep_piRNA_precursors[[16]],motifdep_piRNA_precursors[[24]])
tfiis_EV_np<-aggregate(tfiis_EV_np[,"V6"],by=tfiis_EV_np[c("V1","V2","V3","V4","V5","V12")],FUN=sum)
tfiis_ints11_np<-rbind(motifdep_piRNA_precursors[[17]],motifdep_piRNA_precursors[[25]])
tfiis_ints11_np<-aggregate(tfiis_ints11_np[,"V6"],by=tfiis_ints11_np[c("V1","V2","V3","V4","V5","V12")],FUN=sum)
N2_EV_chr<-rbind(motifdep_piRNA_precursors[[18]],motifdep_piRNA_precursors[[26]])
N2_EV_chr<-aggregate(N2_EV_chr[,"V6"],by=N2_EV_chr[c("V1","V2","V3","V4","V5","V12")],FUN=sum)
N2_ints11_chr<-rbind(motifdep_piRNA_precursors[[19]],motifdep_piRNA_precursors[[27]])
N2_ints11_chr<-aggregate(N2_ints11_chr[,"V6"],by=N2_ints11_chr[c("V1","V2","V3","V4","V5","V12")],FUN=sum)
tfiis_EV_chr<-rbind(motifdep_piRNA_precursors[[20]],motifdep_piRNA_precursors[[28]])
tfiis_EV_chr<-aggregate(tfiis_EV_chr[,"V6"],by=tfiis_EV_chr[c("V1","V2","V3","V4","V5","V12")],FUN=sum)
tfiis_ints11_chr<-rbind(motifdep_piRNA_precursors[[21]],motifdep_piRNA_precursors[[29]])
tfiis_ints11_chr<-aggregate(tfiis_ints11_chr[,"V6"],by=tfiis_ints11_chr[c("V1","V2","V3","V4","V5","V12")],FUN=sum)
motifdep_piRNA_precursors_agg<-list(N2_EV_np,N2_ints11_np,tfiis_EV_np,tfiis_ints11_np,
N2_EV_chr,N2_ints11_chr,tfiis_EV_chr,tfiis_ints11_chr)
names_agg<-c("N2_EV_np","N2_ints11_np","tfiis_EV_np","tfiis_ints11_np",
"N2_EV_chr","N2_ints11_chr","tfiis_EV_chr","tfiis_ints11_chr")
library(reshape2)
library(dplyr)
motifdep_piRNA_precursors_data_summary<-lapply(motifdep_piRNA_precursors_agg,function(df){
number_seqs<-aggregate(df[,"V12"],by=list(df[,"V12"]),FUN=length)
median_length<-aggregate(df[,"V4"],by=list(df[,"V12"]),FUN=median)
mean_length<-aggregate(df[,"V4"],by=list(df[,"V12"]),FUN=mean)
number_reads<-aggregate(df[,"x"],by=list(df[,"V12"]),FUN=sum)
df_uncol<-df[rep(row.names(df), df$x),]
median_length_numreads<-aggregate(df_uncol[,"V4"],by=list(df_uncol[,"V12"]),FUN=median)
mean_length_numreads<-aggregate(df_uncol[,"V4"],by=list(df_uncol[,"V12"]),FUN=mean)
merged<-data.frame(number_seqs$x,
median_length$x,
mean_length$x,
number_reads$x,
median_length_numreads$x,
mean_length_numreads$x)
colnames(merged)<-c("number_seqs","median_length","mean_length","number_reads","median_length_numreads","mean_length_numreads")
rownames(merged)<-number_seqs$Group.1
return(merged)
})
motifdep_piRNA_precursors_agg
motifdep_piRNA_precursors_fig1
motifdep_piRNA_precursors[[7]]
ev_fig1<-motifdep_piRNA_precursors[[7]]
ints11RNAi_fig1<-rbind(motifdep_piRNA_precursors[[8]],motifdep_piRNA_precursors[[9]])
motifdep_piRNA_precursors_fig1<-list(ev_fig1,ints11RNAi_fig1)
names_fig1<-c("N2_EV_total","N2_ints11_total")
library(reshape2)
library(dplyr)
motifdep_piRNA_precursors_data_summary<-lapply(motifdep_piRNA_precursors_fig1,function(df){
number_seqs<-aggregate(df[,"V12"],by=list(df[,"V12"]),FUN=length)
median_length<-aggregate(df[,"V4"],by=list(df[,"V12"]),FUN=median)
mean_length<-aggregate(df[,"V4"],by=list(df[,"V12"]),FUN=mean)
number_reads<-aggregate(df[,"x"],by=list(df[,"V12"]),FUN=sum)
df_uncol<-df[rep(row.names(df), df$x),]
median_length_numreads<-aggregate(df_uncol[,"V4"],by=list(df_uncol[,"V12"]),FUN=median)
mean_length_numreads<-aggregate(df_uncol[,"V4"],by=list(df_uncol[,"V12"]),FUN=mean)
merged<-data.frame(number_seqs$x,
median_length$x,
mean_length$x,
number_reads$x,
median_length_numreads$x,
mean_length_numreads$x)
colnames(merged)<-c("number_seqs","median_length","mean_length","number_reads","median_length_numreads","mean_length_numreads")
rownames(merged)<-number_seqs$Group.1
return(merged)
})
motifdep_piRNA_precursors_agg
ev_fig1<-aggregate(ev_fig1[,"V6"],by=ev_fig1[c("V1","V2","V3","V4","V5","V12")],FUN=sum)
ints11RNAi_fig1<-rbind(motifdep_piRNA_precursors[[8]],motifdep_piRNA_precursors[[9]])
ints11RNAi_fig1<-aggregate(ints11RNAi_fig1[,"V6"],by=ints11RNAi_fig1[c("V1","V2","V3","V4","V5","V12")],FUN=sum)
motifdep_piRNA_precursors_fig1<-list(ev_fig1,ints11RNAi_fig1)
names_fig1<-c("N2_EV_total","N2_ints11_total")
library(reshape2)
library(dplyr)
motifdep_piRNA_precursors_data_summary<-lapply(motifdep_piRNA_precursors_fig1,function(df){
number_seqs<-aggregate(df[,"V12"],by=list(df[,"V12"]),FUN=length)
median_length<-aggregate(df[,"V4"],by=list(df[,"V12"]),FUN=median)
mean_length<-aggregate(df[,"V4"],by=list(df[,"V12"]),FUN=mean)
number_reads<-aggregate(df[,"x"],by=list(df[,"V12"]),FUN=sum)
df_uncol<-df[rep(row.names(df), df$x),]
median_length_numreads<-aggregate(df_uncol[,"V4"],by=list(df_uncol[,"V12"]),FUN=median)
mean_length_numreads<-aggregate(df_uncol[,"V4"],by=list(df_uncol[,"V12"]),FUN=mean)
merged<-data.frame(number_seqs$x,
median_length$x,
mean_length$x,
number_reads$x,
median_length_numreads$x,
mean_length_numreads$x)
colnames(merged)<-c("number_seqs","median_length","mean_length","number_reads","median_length_numreads","mean_length_numreads")
rownames(merged)<-number_seqs$Group.1
return(merged)
})
merged_df<-motifdep_piRNA_precursors_data_summary[[1]]
colnames(merged_df)<-paste0(names_agg[1],colnames(merged_df))
for (i in seq(2,length(names_agg))){
df<-motifdep_piRNA_precursors_data_summary[[i]]
colnames(df)<-paste0(names_agg[i],colnames(df))
merged_df<-merge(merged_df,df,by=0,all=TRUE)
rownames(merged_df)<-merged_df$Row.names
merged_df$Row.names<-NULL
}
merged_df<-motifdep_piRNA_precursors_data_summary[[1]]
colnames(merged_df)<-paste0(names_fig1[1],colnames(merged_df))
for (i in seq(2,length(names_fig1))){
df<-motifdep_piRNA_precursors_data_summary[[i]]
colnames(df)<-paste0(names_fig1[i],colnames(df))
merged_df<-merge(merged_df,df,by=0,all=TRUE)
rownames(merged_df)<-merged_df$Row.names
merged_df$Row.names<-NULL
}
merged_df$rownames<-rownames(merged_df)
sample_index_to_medianlength_index<-function(index){return((index-1)*6+2)}
lenshift<-function(df,treatment_index,control_index,numseqs_threshold){
index1<-sample_index_to_medianlength_index(treatment_index)
index2<-sample_index_to_medianlength_index(control_index)
df<-df[which(df[,index1-1]>numseqs_threshold & df[,index2-1]>numseqs_threshold),]
out<-data.frame(names=as.character(df$rownames),lenshift=df[,index1]-df[,index2])
out$names<-as.character(out$names)
return(out)
}
test<-merged_df[sample_index_to_medianlength_index(2)]-merged_df[sample_index_to_medianlength_index(1)]
thr<-0
median_lenshift_thr<-data.frame(names<-c(lenshift(merged_df,2,1,thr)[,1]),
median_length_shift<-c(lenshift(merged_df,2,1,thr)[,2]),
sample<-c(rep(names_agg[2],nrow(lenshift(merged_df,2,1,thr)))),                            ),
thr<-0
median_lenshift_thr<-data.frame(
names<-c(lenshift(merged_df,2,1,thr)[,1]),
median_length_shift<-c(lenshift(merged_df,2,1,thr)[,2]),
sample<-c(rep(names_agg[2],nrow(lenshift(merged_df,2,1,thr)))),                            ),
lenshift(merged_df,2,1,thr)[,1]
lenshift(merged_df,2,1,thr)[,2]
c(lenshift(merged_df,2,1,thr)[,2]
)
c(rep(names_agg[2],nrow(lenshift(merged_df,2,1,thr))))
c(rep("whole animal",nrow(lenshift(merged_df,2,1,thr))))
c(rep("N2 ints-11 RNAi",nrow(lenshift(merged_df,2,1,thr)))
)
thr<-0
median_lenshift_thr<-data.frame(
names<-c(lenshift(merged_df,2,1,thr)[,1]),
median_length_shift<-c(lenshift(merged_df,2,1,thr)[,2]),
sample<-c(rep(names_agg[2],nrow(lenshift(merged_df,2,1,thr)))),                            ),
names<-c(lenshift(merged_df,2,1,thr)[,1])
median_length_shift<-c(lenshift(merged_df,2,1,thr)[,2])
sample<-c(rep(names_agg[2],nrow(lenshift(merged_df,2,1,thr))))
fraction<-c(rep("whole animal",nrow(lenshift(merged_df,2,1,thr))))
condition<-c(rep("N2 ints-11 RNAi",nrow(lenshift(merged_df,2,1,thr)))
)
names
median_length_shift
sample
fraction
condition
median_lenshift_thr<-data.frame(
names<-c(lenshift(merged_df,2,1,thr)[,1]),
median_length_shift<-c(lenshift(merged_df,2,1,thr)[,2]),
sample<-c(rep(names_agg[2],nrow(lenshift(merged_df,2,1,thr)))),                            ),
thr<-0
median_lenshift_thr<-data.frame(
names<-c(lenshift(merged_df,2,1,thr)[,1]),
median_length_shift<-c(lenshift(merged_df,2,1,thr)[,2]),
sample<-c(rep(names_agg[2],nrow(lenshift(merged_df,2,1,thr)))),
fraction<-c(rep("whole animal",nrow(lenshift(merged_df,2,1,thr)))),
condition<-c(rep("N2 ints-11 RNAi",nrow(lenshift(merged_df,2,1,thr))))
)
colnames(median_lenshift_thr)<-c("piRNA_IDs","median length shift","sample","fraction","condition")
median_lenshift_thr$sample<-factor(median_lenshift_thr$sample,levels = names_agg)
median_lenshift_thr$condition<-factor(median_lenshift_thr$condition,levels=c("N2 ints-11 RNAi")
median_lenshift_thr$fraction<-factor(median_lenshift_thr$fraction,levels=c("total")
median_lenshift_thr$fraction<-factor(median_lenshift_thr$fraction)
ggplot(median_lenshift_thr)+geom_boxplot(aes(y=`median length shift`,x=sample,col=fraction,fill=condition),outlier.shape=NA)+
coord_cartesian(ylim=c(-25,50))+
scale_fill_manual(values=c(alpha("green",0.2),alpha("red",0.2),alpha("blue",0.2)))+
scale_colour_manual(values=c("red","black"))+
geom_hline(yintercept = 0,col="red",linetype="dashed")+
theme_classic()+
ylab("median length shift")+
ggtitle("median length shift - collapsed sequences")
ggsave("median_length_shift_collapsedreads_aggreps_fig1.pdf")
pausing_strength_data<-read.table("../../Reference_pausing_signal_strength/all_pis_typeI_pausingscores.bed",header=TRUE)
pausing_strength_data<-pausing_strength_data[,c(4,10:12)]
pausing_strength_data$V4<-as.character(pausing_strength_data$V4)
median_lenshift_thr_pausingstrength<-merge(median_lenshift_thr,pausing_strength_data,
by.x="piRNA_IDs",by.y="V4")
median_lenshift_thr_pausingstrength$tm_downstream_bins<-factor(median_lenshift_thr_pausingstrength$tm_downstream_bins,                                                                   levels=c("(-713,-94.8]","(-94.8,-18.3]","(-18.3,39.8]","(39.8,101]","(101,412]"))
table(median_lenshift_thr_pausingstrength$tm_downstream_bins)
ggplot(median_lenshift_thr_pausingstrength)+geom_boxplot(aes(y=`median length shift`,x=sample,col=fraction,fill=tm_downstream_bins),outlier.shape=NA)+
coord_cartesian(ylim=c(-25,50))+
scale_colour_manual(values=c("red","black"))+
scale_fill_brewer(palette = "GnBu")+
geom_hline(yintercept = 0,col="red",linetype="dashed")+
theme_classic()+
ylab("median length shift")+
ggtitle("median length shift - collapsed sequences")
ggsave("median_length_shift_collapsedreads_aggreps_fig1_pausingstrength.pdf")
colnames(median_lenshift_thr)<-c("piRNA_IDs","median length shift","sample","fraction","condition")
median_lenshift_thr$sample<-factor(median_lenshift_thr$sample,levels = names_fig1)
median_lenshift_thr$condition<-factor(median_lenshift_thr$condition,levels=c("N2 ints-11 RNAi")
median_lenshift_thr$fraction<-factor(median_lenshift_thr$fraction)
median_lenshift_thr$condition
colnames(median_lenshift_thr)<-c("piRNA_IDs","median length shift","sample","fraction","condition")
median_lenshift_thr$sample<-factor(median_lenshift_thr$sample,levels = names_fig1)
median_lenshift_thr$condition<-factor(median_lenshift_thr$condition,levels=c("N2 ints-11 RNAi")
median_lenshift_thr$fraction<-factor(median_lenshift_thr$fraction)
median_lenshift_thr$sample
names_fig1
thr<-0
median_lenshift_thr<-data.frame(
names<-c(lenshift(merged_df,2,1,thr)[,1]),
median_length_shift<-c(lenshift(merged_df,2,1,thr)[,2]),
sample<-c(rep(names_agg[2],nrow(lenshift(merged_df,2,1,thr)))),
fraction<-c(rep("whole animal",nrow(lenshift(merged_df,2,1,thr)))),
condition<-c(rep("N2 ints-11 RNAi",nrow(lenshift(merged_df,2,1,thr))))
)
colnames(median_lenshift_thr)<-c("piRNA_IDs","median length shift","sample","fraction","condition")
median_lenshift_thr$sample<-factor(median_lenshift_thr$sample,levels = names_fig1[2])
median_lenshift_thr$condition<-factor(median_lenshift_thr$condition,levels=c("N2 ints-11 RNAi")
median_lenshift_thr$fraction<-factor(median_lenshift_thr$fraction)
thr<-0
median_lenshift_thr<-data.frame(
names<-c(lenshift(merged_df,2,1,thr)[,1]),
median_length_shift<-c(lenshift(merged_df,2,1,thr)[,2]),
sample<-c(rep(names_agg[2],nrow(lenshift(merged_df,2,1,thr)))),
fraction<-c(rep("whole animal",nrow(lenshift(merged_df,2,1,thr)))),
condition<-c(rep("N2 ints-11 RNAi",nrow(lenshift(merged_df,2,1,thr))))
)
colnames(median_lenshift_thr)<-c("piRNA_IDs","median length shift","sample","fraction","condition")
median_lenshift_thr$sample<-factor(median_lenshift_thr$sample,levels = names_fig1[2])
median_lenshift_thr$condition<-factor(median_lenshift_thr$condition,levels=c("N2 ints-11 RNAi"))
median_lenshift_thr$fraction<-factor(median_lenshift_thr$fraction)
ggplot(median_lenshift_thr)+geom_boxplot(aes(y=`median length shift`,x=sample,col=fraction,fill=condition),outlier.shape=NA)+
coord_cartesian(ylim=c(-25,50))+
scale_fill_manual(values=c(alpha("green",0.2),alpha("red",0.2),alpha("blue",0.2)))+
scale_colour_manual(values=c("red","black"))+
geom_hline(yintercept = 0,col="red",linetype="dashed")+
theme_classic()+
ylab("median length shift")+
ggtitle("median length shift - collapsed sequences")
ggsave("median_length_shift_collapsedreads_aggreps_fig1.pdf")
pausing_strength_data<-read.table("../../Reference_pausing_signal_strength/all_pis_typeI_pausingscores.bed",header=TRUE)
pausing_strength_data<-pausing_strength_data[,c(4,10:12)]
pausing_strength_data$V4<-as.character(pausing_strength_data$V4)
median_lenshift_thr_pausingstrength<-merge(median_lenshift_thr,pausing_strength_data,
by.x="piRNA_IDs",by.y="V4")
median_lenshift_thr_pausingstrength$tm_downstream_bins<-factor(median_lenshift_thr_pausingstrength$tm_downstream_bins,                                                                   levels=c("(-713,-94.8]","(-94.8,-18.3]","(-18.3,39.8]","(39.8,101]","(101,412]"))
table(median_lenshift_thr_pausingstrength$tm_downstream_bins)
ggplot(median_lenshift_thr_pausingstrength)+geom_boxplot(aes(y=`median length shift`,x=sample,col=fraction,fill=tm_downstream_bins),outlier.shape=NA)+
coord_cartesian(ylim=c(-25,50))+
scale_colour_manual(values=c("red","black"))+
scale_fill_brewer(palette = "GnBu")+
geom_hline(yintercept = 0,col="red",linetype="dashed")+
theme_classic()+
ylab("median length shift")+
ggtitle("median length shift - collapsed sequences")
ggsave("median_length_shift_collapsedreads_aggreps_fig1_pausingstrength.pdf")
merged_df
merged_df_medianlength<-merged_df[,seq(2,44,by = 6)]
merged_df
library(ggplot2)
library(reshape2)
library(scales)
setwd("/Users/ab6415/Documents/Work_laptop_stuff/Bioinformatics/Analysis/INTEGRATOR_PAPER_ANALYSES/Fig1_Fig3_FigS3_FigS4_precursors_analysis/length/")
piRNA_counts_wholeanimal_E1 <- list.files(path="../counts/wholeworm/",
pattern="*pis"); piRNA_counts_wholeanimal_E1<-paste0("../counts/wholeworm/",piRNA_counts_wholeanimal_E1,sep="")
piRNA_counts_wholeanimal_E1_longreads <- list.files(path="../counts/wholeworm_longreads/",
pattern="*pis"); piRNA_counts_wholeanimal_E1_longreads<-paste0("../counts/wholeworm_longreads/",piRNA_counts_wholeanimal_E1_longreads,sep="")
piRNA_counts_germnuclei_total <- list.files(path="../counts/germnuclei_total/",
pattern="*pis"); piRNA_counts_germnuclei_total<-paste0("../counts/germnuclei_total/",piRNA_counts_germnuclei_total,sep="")
piRNA_counts_germnuclei_fractionation <- list.files(path="../counts/germnuclei_fractionation_rep1/",
pattern="*pis"); piRNA_counts_germnuclei_fractionation<-paste0("../counts/germnuclei_fractionation_rep1/",piRNA_counts_germnuclei_fractionation,sep="")
piRNA_counts_germnuclei_fractionation_rep2 <- list.files(path="../counts/germnuclei_fractionation_rep2/",
pattern="*pis"); piRNA_counts_germnuclei_fractionation_rep2<-paste0("../counts/germnuclei_fractionation_rep2/",piRNA_counts_germnuclei_fractionation_rep2,sep="")
piRNA_counts_filenames<-c(piRNA_counts_wholeanimal_E1,piRNA_counts_wholeanimal_E1_longreads,piRNA_counts_germnuclei_total,piRNA_counts_germnuclei_fractionation,piRNA_counts_germnuclei_fractionation_rep2)
piRNA_counts_filenames<-piRNA_counts_filenames[c(1:13,19:21,14:18,27:30,22,23,25,26)]
names <-c("wholeworm_EV_col1","wholeworm_ints11_col1","wholeworm_EV_col2","wholeworm_ints11_col2","wholeworm_EV_96h","wholeworm_ints11_96h","wholeworm_EV_col1_longreads","wholeworm_ints11_col1_longreads","wholeworm_ints11_col2_longreads","germnuclei_total_N2_EV","germnuclei_total_N2_ints11","germnuclei_total_TFIIS_EV","germnuclei_total_TFIIS_ints11","germnuclei_NP_N2_EV","germnuclei_NP_N2_ints11","germnuclei_NP_TFIIS_EV","germnuclei_NP_TFIIS_ints11","germnuclei_CHR_N2_EV","germnuclei_CHR_N2_ints11","germnuclei_CHR_TFIIS_EV","germnuclei_CHR_TFIIS_ints11","germnuclei_rep2_NP_N2_EV","germnuclei_rep2_NP_N2_ints11","germnuclei_rep2_NP_TFIIS_EV","germnuclei_rep2_NP_TFIIS_ints11","germnuclei_rep2_CHR_N2_EV","germnuclei_rep2_CHR_N2_ints11","germnuclei_rep2_CHR_TFIIS_EV","germnuclei_rep2_CHR_TFIIS_ints11")
piRNA_counts_filenames
names
piRNA_counts <- lapply(piRNA_counts_filenames,function(i){
read.csv(paste(i,sep=""), header=FALSE,sep="\t")
})
piRNA_counts_precfiltered <- lapply(piRNA_counts, function(df){
df$plus_d <- df$V10-df$V2
df$minus_d <- df$V3-df$V11
df_plus<-df[which(df$plus_d==2 & df$V8=="+"),]
df_minus<-df[which(df$minus_d==(2) & df$V8=="-"),]
return(rbind(df_plus,df_minus))
})
motifdep_piRNA_precursors<-lapply(piRNA_counts_precfiltered,function(df){return(df[c(grep("^21UR-",df$V12),grep("^piRNA_type_1",df$V12)),])})
motifind_piRNA_precursors<-lapply(piRNA_counts_precfiltered,function(df){return(df[grep("^piRNA_type_2",df$V12),])})
N2_EV<-motifdep_piRNA_precursors[[7]]
N2_EV<-aggregate(N2_EV_np[,"V6"],by=N2_EV_np[c("V1","V2","V3","V4","V5","V12")],FUN=sum)
N2_EV<-motifdep_piRNA_precursors[[7]]
N2_EV<-aggregate(N2_EV[,"V6"],by=N2_EV[c("V1","V2","V3","V4","V5","V12")],FUN=sum)
N2_ints11<-rbind(motifdep_piRNA_precursors[[8]],motifdep_piRNA_precursors[[9]])
N2_ints11<-aggregate(N2_ints11[,"V6"],by=N2_ints11[c("V1","V2","V3","V4","V5","V12")],FUN=sum)
motifdep_piRNA_precursors_fig1<-list(N2_EV,N2_ints11)
names_fig1<-c("N2_EV","N2_ints11")
build_lenmatrix_numreads<-function(df){
loci<-as.character(unique(df$V12))
len_matrix<-matrix(data=0, nrow = length(loci), ncol = 75)
rownames(len_matrix)<-loci
colnames(len_matrix)<-1:75
for (row in seq(nrow(df))){
locus<-as.character(df[row,"V12"])
len<-df[row,"V4"]
numreads<-df[row,"x"]
len_matrix[locus,len]<-numreads
}
return(len_matrix[,18:75])
}
build_lenmatrix_uniqueseqs<-function(df){
loci<-as.character(unique(df$V12))
len_matrix<-matrix(data=0, nrow = length(loci), ncol = 75)
rownames(len_matrix)<-loci
colnames(len_matrix)<-1:75
for (row in seq(nrow(df))){
locus<-as.character(df[row,"V12"])
len<-df[row,"V4"]
len_matrix[locus,len]<-1
}
return(len_matrix[,18:75])
}
len_matrix_numreads<-lapply(motifdep_piRNA_precursors_fig1,FUN=build_lenmatrix_numreads)
motifdep_piRNA_precursors_fig1
build_lenmatrix_numreads<-function(df){
loci<-as.character(unique(df$V12))
len_matrix<-matrix(data=0, nrow = length(loci), ncol = 75)
rownames(len_matrix)<-loci
colnames(len_matrix)<-1:75
for (row in seq(nrow(df))){
locus<-as.character(df[row,"V12"])
len<-df[row,"V4"]
numreads<-df[row,"x"]
len_matrix[locus,len]<-numreads
}
return(len_matrix[,18:75])
}
build_lenmatrix_uniqueseqs<-function(df){
loci<-as.character(unique(df$V12))
len_matrix<-matrix(data=0, nrow = length(loci), ncol = 75)
rownames(len_matrix)<-loci
colnames(len_matrix)<-1:75
for (row in seq(nrow(df))){
locus<-as.character(df[row,"V12"])
len<-df[row,"V4"]
len_matrix[locus,len]<-1
}
return(len_matrix[,18:75])
}
build_lenmatrix_numreads<-function(df){
loci<-as.character(unique(df$V12))
len_matrix<-matrix(data=0, nrow = length(loci), ncol = 75)
rownames(len_matrix)<-loci
colnames(len_matrix)<-1:75
for (row in seq(nrow(df))){
locus<-as.character(df[row,"V12"])
len<-df[row,"V4"]
numreads<-df[row,"x"]
len_matrix[locus,len]<-numreads
}
return(len_matrix[,18:75])
}
build_lenmatrix_uniqueseqs<-function(df){
loci<-as.character(unique(df$V12))
len_matrix<-matrix(data=0, nrow = length(loci), ncol = 75)
rownames(len_matrix)<-loci
colnames(len_matrix)<-1:75
for (row in seq(nrow(df))){
locus<-as.character(df[row,"V12"])
len<-df[row,"V4"]
len_matrix[locus,len]<-1
}
return(len_matrix[,18:75])
}
motifdep_piRNA_precursors_fig1
range(motifdep_piRNA_precursors_fig1[[1]][4])
range(motifdep_piRNA_precursors_fig1[[2]][4])
max(motifdep_piRNA_precursors_fig1[[1]][4])
unique(motifdep_piRNA_precursors_fig1[[1]][4])
tabulate(motifdep_piRNA_precursors_fig1[[1]][4])
motifdep_piRNA_precursors_fig1[[1]][4]
tabulate(motifdep_piRNA_precursors_fig1[[1]]$V4)
tabulate(motifdep_piRNA_precursors_fig1[[2]]$V4)
build_lenmatrix_numreads<-function(df){
df<-df[which(df$V4<86),]
loci<-as.character(unique(df$V12))
len_matrix<-matrix(data=0, nrow = length(loci), ncol = 75)
rownames(len_matrix)<-loci
colnames(len_matrix)<-1:85
for (row in seq(nrow(df))){
locus<-as.character(df[row,"V12"])
len<-df[row,"V4"]
numreads<-df[row,"x"]
len_matrix[locus,len]<-numreads
}
return(len_matrix[,18:85])
}
build_lenmatrix_uniqueseqs<-function(df){
df<-df[which(df$V4<86),]
loci<-as.character(unique(df$V12))
len_matrix<-matrix(data=0, nrow = length(loci), ncol = 75)
rownames(len_matrix)<-loci
colnames(len_matrix)<-1:85
for (row in seq(nrow(df))){
locus<-as.character(df[row,"V12"])
len<-df[row,"V4"]
len_matrix[locus,len]<-1
}
return(len_matrix[,18:85])
}
len_matrix_numreads<-lapply(motifdep_piRNA_precursors_fig1,FUN=build_lenmatrix_numreads)
build_lenmatrix_numreads<-function(df){
df<-df[which(df$V4<86),]
loci<-as.character(unique(df$V12))
len_matrix<-matrix(data=0, nrow = length(loci), ncol = 85)
rownames(len_matrix)<-loci
colnames(len_matrix)<-1:85
for (row in seq(nrow(df))){
locus<-as.character(df[row,"V12"])
len<-df[row,"V4"]
numreads<-df[row,"x"]
len_matrix[locus,len]<-numreads
}
return(len_matrix[,18:85])
}
build_lenmatrix_uniqueseqs<-function(df){
df<-df[which(df$V4<86),]
loci<-as.character(unique(df$V12))
len_matrix<-matrix(data=0, nrow = length(loci), ncol = 85)
rownames(len_matrix)<-loci
colnames(len_matrix)<-1:85
for (row in seq(nrow(df))){
locus<-as.character(df[row,"V12"])
len<-df[row,"V4"]
len_matrix[locus,len]<-1
}
return(len_matrix[,18:85])
}
len_matrix_numreads<-lapply(motifdep_piRNA_precursors_fig1,FUN=build_lenmatrix_numreads)
len_matrix_uniqueseqs<-lapply(motifdep_piRNA_precursors_fig1,FUN=build_lenmatrix_uniqueseqs)
for (i in seq(length(len_matrix_numreads))){
data<-len_matrix_uniqueseqs[[i]]
data<-data[order(apply(data,MARGIN=1,FUN=sum),decreasing = FALSE),]
melted_data<-melt(data)
melted_data$Var1<-factor(melted_data$Var1,levels=rownames(data))
print(ggplot(melted_data, aes(Var2,Var1, fill=value)) + geom_raster() +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
ylab("motif-dependent piRNA loci")+xlab("precursor length")+
scale_fill_distiller(palette = "Greys")+
ggtitle(names_agg[i]))
ggsave(paste(names_agg[i],"_fig1_lendist_heatmap.pdf",sep=""))
print(ggplot(melted_data, aes(Var2,Var1, fill=value)) + geom_raster() +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
ylab("motif-dependent piRNA loci")+xlab("precursor length")+
scale_fill_distiller(palette = "Greys")+
ggtitle(names_agg[i]))
ggplot(melted_data, aes(Var2,Var1, fill=value)) + geom_raster() +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
ylab("motif-dependent piRNA loci")+xlab("precursor length")+
scale_fill_distiller(palette = "Greys")+
ggtitle(names_agg[i])
)))))
for (i in seq(length(len_matrix_numreads))){
data<-len_matrix_uniqueseqs[[i]]
data<-data[order(apply(data,MARGIN=1,FUN=sum),decreasing = FALSE),]
melted_data<-melt(data)
melted_data$Var1<-factor(melted_data$Var1,levels=rownames(data))
print(ggplot(melted_data, aes(Var2,Var1, fill=value)) + geom_raster() +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
ylab("motif-dependent piRNA loci")+xlab("precursor length")+
scale_fill_distiller(palette = "Greys")+
ggtitle(names_agg[i]))
ggsave(paste(names_agg[i],"_fig1_lendist_heatmap.pdf",sep=""))
data<-len_matrix_numreads[[i]]
data<-data[order(apply(data,MARGIN=1,FUN=sum),decreasing = FALSE),]
melted_data<-melt(data)
melted_data$Var1<-factor(melted_data$Var1,levels=rownames(data))
print(ggplot(melted_data, aes(Var2,Var1, fill=value)) + geom_raster() +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
scale_fill_gradientn(colors=c("white","red","blue","black"),values=scales::rescale(c(0,1,5,10,50,1000,100000)))+
ylab("motif-dependent piRNA loci")+xlab("precursor length")+
ggtitle(names_agg[i]))
}
