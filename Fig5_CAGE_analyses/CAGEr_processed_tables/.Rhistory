ttg_MAplot_data<-ttg_MAplot_data[which(ttg_MAplot_data$padj<1e-4),]
length(unique(ttg_MAplot_data$ID))
plot_allvsall_cors_twoLineages(log2(ttg_DEseqnorm[,1:24]+1),ttg_MAplot_data$ID,"epimutated genes",plot=TRUE)
csr1_targets<-read.table("../07_Gene_Sets/CSR1_targets"); csr1_targets<-csr1_targets$x
csr1_targets_nobatch<-removebatch(csr1_targets,csr1_targets)
hrde1_targets<-read.table("../07_Gene_Sets/WAGO9_targets"); hrde1_targets<-hrde1_targets$x
hrde1_targets_nobatch<-removebatch(hrde1_targets,hrde1_targets)
plot_allvsall_cors_twoLineages(log2(ttg_DEseqnorm[,1:24]+1),csr1_targets_nobatch,"csr-1 targets",plot=TRUE)
plot_allvsall_cors_twoLineages(log2(ttg_DEseqnorm[,1:24]+1),hrde1_targets_nobatch,"hrde-1 targets",plot=TRUE)
length(unique(ttg_MAplot_data$ID))
cors_csr1<-rep(0,1000)
for (i in seq(1000)){
#print(i)
csr_1_subset<-sample(csr1_targets_nobatch,145)
cors_csr1[i]<-plot_allvsall_cors_twoLineages(log2(ttg_DEseqnorm[,1:24]+1),csr_1_subset,"csr-1 subsets",plot=FALSE)
}
csr_1_cordata<-data.frame(cors_csr1=cors_csr1)
ggplot(csr_1_cordata)+geom_histogram(aes(x=cors_csr1),breaks=seq(-0.8,0.2,0.025))+ggtitle("CSR-1 bootstrapped correlation coefficients")+geom_vline(xintercept=-0.7739395,color="red")
cors_hrde1<-rep(0,1000)
for (i in seq(1000)){
#print(i)
hrde_1_subset<-sample(hrde1_targets_nobatch,145)
cors_hrde1[i]<-plot_allvsall_cors_twoLineages(log2(ttg_DEseqnorm[,1:24]+1),hrde_1_subset,"hrde-1 subsets",plot=FALSE)
}
hrde_1_cordata<-data.frame(cors_hrde1=cors_hrde1)
ggplot(hrde_1_cordata)+geom_histogram(aes(x=cors_hrde1),breaks=seq(-0.8,0.2,0.025))+ggtitle("HRDE-1 bootstrapped correlation coefficients")+geom_vline(xintercept=-0.7739395,color="red")
plot_allvsall_cors_within_between<-function(df,gene_set,title){
df<-df[which(rownames(df) %in% gene_set),]
heatmap.2(cor(as.matrix(df)),Rowv = FALSE,Colv = FALSE,trace="none",main=title)
heatmap.2(cor(as.matrix(df)),trace="none",main=title)
gendistances<-read.table("genbygen_distances_2lineages.txt"); gendistances<-gendistances[-c(7,20),-c(7,20)]
withinbetween_data<-read.table("within_between_matrix.txt")
colnames(gendistances)<-colnames(df); colnames(withinbetween_data)<-colnames(df)
final_cordata_W<-data.frame(cors="",gens="")
final_cordata_W$cors<-as.numeric(final_cordata_W$cors)
final_cordata_W$gens<-as.numeric(final_cordata_W$gens)
final_cordata_B<-data.frame(cors="",gens="")
final_cordata_B$cors<-as.numeric(final_cordata_B$cors)
final_cordata_B$gens<-as.numeric(final_cordata_B$gens)
for (i in seq(24)){
cordata_W<-data.frame(cors=cor(as.matrix(df))[which(gendistances==i & withinbetween_data=="W")],gens=rep(i,length(which(gendistances==i & withinbetween_data=="W"))))
final_cordata_W<-rbind.data.frame(final_cordata_W,cordata_W)
cordata_B<-data.frame(cors=cor(as.matrix(df))[which(gendistances==i & withinbetween_data=="B")],gens=rep(i,length(which(gendistances==i & withinbetween_data=="B"))))
final_cordata_B<-rbind.data.frame(final_cordata_B,cordata_B)
}
final_cordata_W<-final_cordata_W[-1,]
nrow(final_cordata_W)
final_cordata_W$gens<-as.factor(final_cordata_W$gens)
final_cordata_B<-final_cordata_B[-1,]
nrow(final_cordata_B)
final_cordata_B$gens<-as.factor(final_cordata_B$gens)
print(ggplot(final_cordata_W)+geom_dotplot(aes(x=final_cordata_W$gens,y=final_cordata_W$cors),binaxis='y', stackdir='center')+xlab("number of generations separating samples")+ylab("Pearson correlation coefficient")+ggtitle(paste(title,"within",sep=",")))
print(ggplot(final_cordata_W)+geom_boxplot(aes(x=final_cordata_W$gens,y=final_cordata_W$cors))+xlab("number of generations separating samples")+ylab("Pearson correlation coefficient")+ggtitle(paste(title,"within",sep=",")))
print(cor(as.numeric(final_cordata_W$gens),as.numeric(final_cordata_W$cors)))
print(cor.test(as.numeric(final_cordata_W$gens),as.numeric(final_cordata_W$cors)))
test<-cor.test(as.numeric(final_cordata_W$gens),as.numeric(final_cordata_W$cors))
print(test$p.value)
print(ggplot(final_cordata_B)+geom_dotplot(aes(x=final_cordata_B$gens,y=final_cordata_B$cors),binaxis='y', stackdir='center')+xlab("number of generations separating samples")+ylab("Pearson correlation coefficient")+ggtitle(paste(title,"between",sep=",")))
print(ggplot(final_cordata_B)+geom_boxplot(aes(x=final_cordata_B$gens,y=final_cordata_B$cors))+xlab("number of generations separating samples")+ylab("Pearson correlation coefficient")+ggtitle(paste(title,"between",sep=",")))
print(cor(as.numeric(final_cordata_B$gens),as.numeric(final_cordata_B$cors)))
print(cor.test(as.numeric(final_cordata_B$gens),as.numeric(final_cordata_B$cors)))
}
plot_allvsall_cors_within_between(log2(ttg_DEseqnorm[,1:24]+1),unique(ttg_MAplot_data$ID),"epimutated genes")
log2(ttg_DEseqnorm[,1:24]
+1)
df<-log2(ttg_DEseqnorm[,1:24]+1)
gene_set<-unique(ttg_MAplot_data$ID)
title<-"epimutated_genes"
df<-df[which(rownames(df) %in% gene_set),]
df
heatmap.2(cor(as.matrix(df)),Rowv = FALSE,Colv = FALSE,trace="none",main=title)
heatmap.2(cor(as.matrix(df)),trace="none",main=title)
heatmap.2(cor(as.matrix(df)),Rowv = FALSE,Colv = FALSE,trace="none",dendrogram = FALSE,main=title)
heatmap.2(cor(as.matrix(df)),Rowv = FALSE,Colv = FALSE,trace="none",dendrogram = "none",main=title)
heatmap.2(cor(as.matrix(df)),trace="none",main=title)
gendistances<-read.table("genbygen_distances_2lineages.txt")
shape(gendistances)
nrow(gendistances)
ncol(gendistances)
nrow(df)
nrow(cor(as.matrix(df))
)
ncol(cor(as.matrix(df)))
gendistances<-gendistances[-c(7,20),-c(7,20)]
ncol(gendistances)
nrow(gendistances)
withinbetween_data<-read.table("within_between_matrix.txt")
colnames(gendistances)<-colnames(df); colnames(withinbetween_data)<-colnames(df)
gendistances
final_cordata_W<-data.frame(cors="",gens="")
final_cordata_W$cors<-as.numeric(final_cordata_W$cors)
final_cordata_W$gens<-as.numeric(final_cordata_W$gens)
final_cordata_B<-data.frame(cors="",gens="")
final_cordata_B$cors<-as.numeric(final_cordata_B$cors)
final_cordata_B$gens<-as.numeric(final_cordata_B$gens)
for (i in seq(24)){
cordata_W<-data.frame(cors=cor(as.matrix(df))[which(gendistances==i & withinbetween_data=="W")],gens=rep(i,length(which(gendistances==i & withinbetween_data=="W"))))
final_cordata_W<-rbind.data.frame(final_cordata_W,cordata_W)
cordata_B<-data.frame(cors=cor(as.matrix(df))[which(gendistances==i & withinbetween_data=="B")],gens=rep(i,length(which(gendistances==i & withinbetween_data=="B"))))
final_cordata_B<-rbind.data.frame(final_cordata_B,cordata_B)
}
cordata_W
cordata_B
final_cordata_B
plot_allvsall_cors_within_between<-function(df,gene_set,title){
df<-df[which(rownames(df) %in% gene_set),]
heatmap.2(cor(as.matrix(df)),Rowv = FALSE,Colv = FALSE,trace="none",dendrogram = "none",main=title)
heatmap.2(cor(as.matrix(df)),trace="none",main=title)
gendistances<-read.table("genbygen_distances_2lineages.txt"); gendistances<-gendistances[-c(7,20),-c(7,20)]
withinbetween_data<-read.table("within_between_matrix.txt")
colnames(gendistances)<-colnames(df); colnames(withinbetween_data)<-colnames(df)
final_cordata_W<-data.frame(cors="",gens="")
final_cordata_W$cors<-as.numeric(final_cordata_W$cors)
final_cordata_W$gens<-as.numeric(final_cordata_W$gens)
final_cordata_B<-data.frame(cors="",gens="")
final_cordata_B$cors<-as.numeric(final_cordata_B$cors)
final_cordata_B$gens<-as.numeric(final_cordata_B$gens)
for (i in seq(26)){
cordata_W<-data.frame(cors=cor(as.matrix(df))[which(gendistances==i & withinbetween_data=="W")],gens=rep(i,length(which(gendistances==i & withinbetween_data=="W"))))
final_cordata_W<-rbind.data.frame(final_cordata_W,cordata_W)
cordata_B<-data.frame(cors=cor(as.matrix(df))[which(gendistances==i & withinbetween_data=="B")],gens=rep(i,length(which(gendistances==i & withinbetween_data=="B"))))
final_cordata_B<-rbind.data.frame(final_cordata_B,cordata_B)
}
final_cordata_W<-final_cordata_W[-1,]
nrow(final_cordata_W)
final_cordata_W$gens<-as.factor(final_cordata_W$gens)
final_cordata_B<-final_cordata_B[-1,]
nrow(final_cordata_B)
final_cordata_B$gens<-as.factor(final_cordata_B$gens)
print(ggplot(final_cordata_W)+geom_dotplot(aes(x=final_cordata_W$gens,y=final_cordata_W$cors),binaxis='y', stackdir='center')+xlab("number of generations separating samples")+ylab("Pearson correlation coefficient")+ggtitle(paste(title,"within",sep=",")))
print(ggplot(final_cordata_W)+geom_boxplot(aes(x=final_cordata_W$gens,y=final_cordata_W$cors))+xlab("number of generations separating samples")+ylab("Pearson correlation coefficient")+ggtitle(paste(title,"within",sep=",")))
print(cor(as.numeric(final_cordata_W$gens),as.numeric(final_cordata_W$cors)))
print(cor.test(as.numeric(final_cordata_W$gens),as.numeric(final_cordata_W$cors)))
test<-cor.test(as.numeric(final_cordata_W$gens),as.numeric(final_cordata_W$cors))
print(test$p.value)
print(ggplot(final_cordata_B)+geom_dotplot(aes(x=final_cordata_B$gens,y=final_cordata_B$cors),binaxis='y', stackdir='center')+xlab("number of generations separating samples")+ylab("Pearson correlation coefficient")+ggtitle(paste(title,"between",sep=",")))
print(ggplot(final_cordata_B)+geom_boxplot(aes(x=final_cordata_B$gens,y=final_cordata_B$cors))+xlab("number of generations separating samples")+ylab("Pearson correlation coefficient")+ggtitle(paste(title,"between",sep=",")))
print(cor(as.numeric(final_cordata_B$gens),as.numeric(final_cordata_B$cors)))
print(cor.test(as.numeric(final_cordata_B$gens),as.numeric(final_cordata_B$cors)))
}
plot_allvsall_cors_within_between(log2(ttg_DEseqnorm[,1:24]+1),unique(ttg_MAplot_data$ID),"epimutated genes")
plot_allvsall_cors_twoLineages_return_cordata<-function(df,gene_set,title){
df<-df[which(rownames(df) %in% gene_set),]
gendistances<-read.table("genbygen_distances_2lineages.txt"); gendistances<-gendistances[-c(7,20),-c(7,20)]
colnames(gendistances)<-colnames(df)
final_cordata<-data.frame(cors="",gens="")
final_cordata$cors<-as.numeric(final_cordata$cors)
final_cordata$gens<-as.numeric(final_cordata$gens)
for (i in seq(26)){
cordata<-data.frame(cors=cor(as.matrix(df))[which(gendistances==i)],gens=rep(i,length(which(gendistances==i))))
final_cordata<-rbind.data.frame(final_cordata,cordata)
}
final_cordata<-final_cordata[-1,]
nrow(final_cordata)
final_cordata$gens<-as.factor(final_cordata$gens)
return(final_cordata)
}
ma_fdr0.01_cordata<-plot_allvsall_cors_twoLineages_return_cordata(log2(ttg_DEseqnorm[,1:24]+1),unique(ttg_MAplot_data$ID),"tit")
csr1_cordata<-plot_allvsall_cors_twoLineages_return_cordata(log2(ttg_DEseqnorm[,1:24]+1),csr1_targets_nobatch,"tit")
ma_fdr0.01_cordata$group<-rep("ma",nrow(ma_fdr0.01_cordata))
csr1_cordata$group<-rep("csr1",nrow(csr1_cordata))
cordata_combined<-rbind(ma_fdr0.01_cordata,csr1_cordata)
ggplot(cordata_combined,aes(x=gens,y=cors))+geom_dotplot(aes(fill=group,color=group),binaxis='y',stackdir='center',binwidth=0.003,alpha=0.8)+
xlab("number of generations separating samples")+
ylab("Pearson correlation coefficient")+
stat_summary(data=cordata_combined[which(cordata_combined$group=="ma"),],mapping=aes(x=gens,y=cors),fun.y = median, fun.ymin = median, fun.ymax = median,geom = "point", width = 0.5,color="black")+
stat_summary(data=cordata_combined[which(cordata_combined$group=="csr1"),],mapping=aes(x=gens,y=cors),fun.y = median, fun.ymin = median, fun.ymax = median,geom = "point", width = 0.5,color="grey")+
theme_classic()
ggsave("epimutated_genes_vs_CSR1_targets_cors_dotplot.pdf",dpi="retina",width=9)
fit_csr<-lm(data = csr1_cordata,formula = cors~as.numeric(gens))
summary(fit_csr)
fit_ma<-lm(data = ma_fdr0.01_cordata,formula = cors~as.numeric(gens))
summary(fit_ma)
ggplot(cordata_combined,aes(x=gens,y=cors))+
geom_point(aes(fill=group,color=group),binaxis='y', stackdir='center',binwidth=0.003,alpha=0.8)+
xlab("number of generations separating samples")+
ylab("Pearson correlation coefficient")+
geom_abline(slope=-0.0048,intercept = 0.9353576,color="red")+
geom_abline(slope=-0.0001919,intercept = 0.9697,color="blue")+
stat_summary(data=cordata_combined[which(cordata_combined$group=="ma"),],mapping=aes(x=gens,y=cors),fun.y = median, fun.ymin = median, fun.ymax = median,geom = "crossbar", width = 0.5,color="red")+
stat_summary(data=cordata_combined[which(cordata_combined$group=="csr1"),],mapping=aes(x=gens,y=cors),fun.y = median, fun.ymin = median, fun.ymax = median,geom = "crossbar", width = 0.5,color="black")+
theme_classic()
ggsave("epimutated_genes_vs_CSR1_targets_cors_dotplot_with_linefit.pdf")
fit_csr$coefficients
fit_ma$coefficients
ggplot(cordata_combined,aes(x=gens,y=cors))+
geom_point(aes(fill=group,color=group),binaxis='y', stackdir='center',binwidth=0.003,alpha=0.8)+
xlab("number of generations separating samples")+
ylab("Pearson correlation coefficient")+
geom_abline(slope=-0.004520427,intercept = 0.933289003,color="red")+
geom_abline(slope=-0.0001434889 ,intercept = 0.9694561162,color="blue")+
stat_summary(data=cordata_combined[which(cordata_combined$group=="ma"),],mapping=aes(x=gens,y=cors),fun.y = median, fun.ymin = median, fun.ymax = median,geom = "crossbar", width = 0.5,color="red")+
stat_summary(data=cordata_combined[which(cordata_combined$group=="csr1"),],mapping=aes(x=gens,y=cors),fun.y = median, fun.ymin = median, fun.ymax = median,geom = "crossbar", width = 0.5,color="black")+
theme_classic()
ggsave("epimutated_genes_vs_CSR1_targets_cors_dotplot_with_linefit.pdf")
fit_ma$coefficients
fit_ma$coefficients[1]
fit_csr$model
summary(fit_csr)
cor(fit_csr$model)
cor(fit_ma$model)
cor(fit_csr$model)[1,2]
cor(fit_ma$model)[1,2]
cor(fit_csr$model)[1,2]
cor.test(fit_csr$model)
cor.test(fit_csr$model$cors,fit_csr$model$`as.numeric(gens)`)
cor.test(fit_csr$model$cors,fit_csr$model$`as.numeric(gens)`,method = "spearman")
cor.test(fit_csr$model$cors,fit_csr$model$`as.numeric(gens)`,method = "Pearson")
cor.test(fit_csr$model$cors,fit_csr$model$`as.numeric(gens)`,method = "pearson")
cor.test(fit_ma$model$cors,fit_ma$model$`as.numeric(gens)`,method = "spearman")
cor.test(fit_csr$model$cors,fit_csr$model$`as.numeric(gens)`,method = "spearman")
cor.test(fit_csr$model$cors,fit_csr$model$`as.numeric(gens)`,method = "pearson")
cor.test(fit_ma$model$cors,fit_ma$model$`as.numeric(gens)`,method = "pearson")
cor.test(fit_ma$model$cors,fit_ma$model$`as.numeric(gens)`,method = "pearson")
cor.test(fit_csr$model$cors,fit_csr$model$`as.numeric(gens)`,method = "pearson")
setwd("/Users/ab6415/Documents/Work_laptop_stuff/Bioinformatics/Analysis/INTEGRATOR_PAPER_ANALYSES/Fig5_CAGE_analyses/")
cage_pis<-read.table("CAGEr_processed_tables/CTSSnormalizedTPM.csv")
cage_pis
cagedata_pis<-read.table("piRNAnormalisedExpression.txt",header=TRUE)
setwd("/Users/ab6415/Documents/Work_laptop_stuff/Bioinformatics/Analysis/INTEGRATOR_PAPER_ANALYSES/Fig5_CAGE_analyses/CAGEr_processed_tables/")
cagedata_pis<-read.table("piRNAnormalisedExpression.txt",header=TRUE)
cagedata_pis<-cagedata_pis[which(cagedata_pis$dist==2),]
library(tidyr)
library(ggplot2)
cagedata_cols<- cagedata_pis %>% spread(sample,tags)
cagedata_cols[is.na(cagedata_cols)]<-0
cagedata_pis_agg<-aggregate(cagedata_cols[,14:21],by=list(cagedata_cols[,13]),FUN=sum)
cagedata_pis[which(cagedata_pis$seqnames.start.end=="chrI,10161941,10161961"),]
cagedata_pis_agg[which(cagedata_pis_agg$Group.1=="chrI,10161941,10161961"),]
pairwise_fc<-function(df,col1,col2,pseudoTPMs){
df<-df[which((df[,col1]+df[,col2])>0),]
return(log2(df[,col2]+pseudoTPMs)-log2(df[,col1]+pseudoTPMs))
}
cagedata_pis_averaged<-data.frame(
pos=cagedata_pis_agg$Group.1,
N2_EV=0.5*cagedata_pis_agg$N2_EV1_star2+0.5*cagedata_pis_agg$N2_EV2_star2,
N2_RNAi=0.5*cagedata_pis_agg$N2_RNAi1_star2+0.5*cagedata_pis_agg$N2_RNAi2_star2,
TFIIS_EV=cagedata_pis_agg$TFIIS_EV2_star2,
TFIIS_RNAi=0.5*cagedata_pis_agg$TFIIS_RNAi1_star2+0.5*cagedata_pis_agg$TFIIS_RNAi2_star2,
total=cagedata_pis_agg$TEV_star2
)
pos_to_type_mappings<-unique(cagedata_pis[,c("name","seqnames.start.end")])
cagedata_pis_averaged_types<-merge(cagedata_pis_averaged,pos_to_type_mappings,by.x="pos",by.y="seqnames.start.end",all=TRUE)
table(cagedata_pis_averaged_types$name)
cagedata_pis_averaged_typeI<-cagedata_pis_averaged_types[which(cagedata_pis_averaged_types$name=="21UR" | cagedata_pis_averaged_types$name=="piRNA_type1"),]
cagedata_pis_averaged_typeII<-cagedata_pis_averaged_types[which(cagedata_pis_averaged_types$name=="piRNA_type2"),]
cagedata_pis_averaged_typeI
cagedata_pis_averaged
write.table(cagedata_pis_averaged_typeI,quote=FALSE,sep="\t",file = "averaged_CAGEsignal_typeIpis.txt")
format_pos<-read.table("pos_replaced_chr")
format_pos
format_pos<-read.table("pos_replaced_chr",header=TRUE)
format_pos
cagedata_pis_averaged_typeI
cagedata_pis_averaged_typeI$chr<-format_pos$chr
cagedata_pis_averaged_typeI$st<-format_pos$st
cagedata_pis_averaged_typeI$end<-format_pos$end
cagedata_pis_averaged_typeI
read.table("../../Reference_annotations/all_pis_typeI.bed")
pi_ids<-read.table("../../Reference_annotations/all_pis_typeI.bed")
pi_ids
merge(cagedata_pis_averaged_typeI,pi_ids,by.x=("chr","st"),by.y=c("V1","V2"),all.x=TRUE)
merge(cagedata_pis_averaged_typeI,pi_ids,by.x=c("chr","st"),by.y=c("V1","V2"),all.x=TRUE)
pi_ids
cagedata_pis_averaged_typeI
cagedata_pis_averaged_typeI$chr<-as.character(cagedata_pis_averaged_typeI$chr)
merge(cagedata_pis_averaged_typeI,pi_ids,by.x=c("chr","st"),by.y=c("V1","V2"),all.x=TRUE)
pi_ids
cagedata_pis_averaged_typeI
merge(cagedata_pis_averaged_typeI,pi_ids,by.x=c("chr","st"),by.y=c("V1","V2"),all.x=TRUE)
cagedata_pis_averaged_typeI$st<-cagedata_pis_averaged_typeI$st-1
merge(cagedata_pis_averaged_typeI,pi_ids,by.x=c("chr","st"),by.y=c("V1","V2"),all.x=TRUE)
pis_cagedata_with_ID<-merge(cagedata_pis_averaged_typeI,pi_ids,by.x=c("chr","st"),by.y=c("V1","V2"),all.x=TRUE)
pis_cagedata_with_ID
N2_EV<-pis_cagedata_with_ID[which(pis_cagedata_with_ID$N2_EV>0),"V4"]
N2_EV
N2_EV<-pis_cagedata_with_ID[which(pis_cagedata_with_ID$N2_EV>0),"V4"]
N2_ints11RNAi<-pis_cagedata_with_ID[which(pis_cagedata_with_ID$N2_EV>0),"V4"]
TFIIS_EV<-pis_cagedata_with_ID[which(pis_cagedata_with_ID$N2_EV>0),"V4"]
TFIIS_ints11RNAi<-pis_cagedata_with_ID[which(pis_cagedata_with_ID$N2_EV>0),"V4"]
all_detected<-pis_cagedata_with_ID[,"V4"]
N2_EV<-pis_cagedata_with_ID[which(pis_cagedata_with_ID$N2_EV>0),"V4"]
N2_ints11RNAi<-pis_cagedata_with_ID[which(pis_cagedata_with_ID$N2_RNAi>0),"V4"]
TFIIS_EV<-pis_cagedata_with_ID[which(pis_cagedata_with_ID$TFIIS_EV>0),"V4"]
TFIIS_ints11RNAi<-pis_cagedata_with_ID[which(pis_cagedata_with_ID$TFIIS_RNAi>0),"V4"]
all_detected<-pis_cagedata_with_ID[,"V4"]
TFIIS_ints11RNAi
TFIIS_EV
N2_ints11RNAi
N2_EV
N2_EV<-as.character(pis_cagedata_with_ID[which(pis_cagedata_with_ID$N2_EV>0),"V4"])
N2_ints11RNAi<-as.character(pis_cagedata_with_ID[which(pis_cagedata_with_ID$N2_RNAi>0),"V4"])
TFIIS_EV<-as.character(pis_cagedata_with_ID[which(pis_cagedata_with_ID$TFIIS_EV>0),"V4"])
TFIIS_ints11RNAi<-as.character(pis_cagedata_with_ID[which(pis_cagedata_with_ID$TFIIS_RNAi>0),"V4"])
all_detected<-as.character(pis_cagedata_with_ID[,"V4"])
N2_EV
termination_signal_strength<-read.table("../../Reference_pausing_signal_strength/all_pis_typeI_pausingscores.bed")
termination_signal_strength
termination_signal_strength<-read.table("../../Reference_pausing_signal_strength/all_pis_typeI_pausingscores.bed",header=TRUE)
termination_signal_strength
boxplot(termination_signal_strength$tm_downstream)
termination_signal_strength$V4
termination_signal_strength$V4<-as.character(termination_signal_strength$V4)
termination_signal_strength
boxplot(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% all_detected),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"tm_downstream"])
boxplot(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% all_detected),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"tm_downstream"],
names=c("all loci","any condition","N2 EV","N2 ints-11 RNAi","TFIIS","TFIIS ints-11 RNAi"))
boxplot(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% all_detected),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"tm_downstream"],
names=c("all loci","any condition","N2 EV","N2 ints-11 RNAi","TFIIS","TFIIS ints-11 RNAi"),
outline=FALSE)
boxplot(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% all_detected),"tm_total"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"tm_total"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"tm_total"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"tm_total"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"tm_total"],
names=c("all loci","any condition","N2 EV","N2 ints-11 RNAi","TFIIS","TFIIS ints-11 RNAi"),
outline=FALSE)
termination_signal_strength
boxplot(termination_signal_strength$total,
termination_signal_strength[which(termination_signal_strength$V4 %in% all_detected),"total"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"total"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"total"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"total"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"total"],
names=c("all loci","any condition","N2 EV","N2 ints-11 RNAi","TFIIS","TFIIS ints-11 RNAi"),
outline=FALSE)
boxplot(termination_signal_strength$tm_upstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% all_detected),"tm_upstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"tm_upstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"tm_upstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"tm_upstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"tm_upstream"],
names=c("all loci","any condition","N2 EV","N2 ints-11 RNAi","TFIIS","TFIIS ints-11 RNAi"),
outline=FALSE,main="upstream Tm")
boxplot(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% all_detected),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"tm_downstream"],
names=c("all loci","any condition","N2 EV","N2 ints-11 RNAi","TFIIS","TFIIS ints-11 RNAi"),
outline=FALSE,main="downstream Tm")
violin(termination_signal_strength$tm_upstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% all_detected),"tm_upstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"tm_upstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"tm_upstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"tm_upstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"tm_upstream"],
names=c("all loci","any condition","N2 EV","N2 ints-11 RNAi","TFIIS","TFIIS ints-11 RNAi"),
outline=FALSE,main="upstream Tm")
boxplot(termination_signal_strength$tm_upstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% all_detected),"tm_upstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"tm_upstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"tm_upstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"tm_upstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"tm_upstream"],
names=c("all loci","any condition","N2 EV","N2 ints-11 RNAi","TFIIS","TFIIS ints-11 RNAi"),
outline=FALSE,main="upstream Tm")
boxplot(termination_signal_strength$total,
termination_signal_strength[which(termination_signal_strength$V4 %in% all_detected),"total"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"total"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"total"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"total"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"total"],
names=c("all loci","any condition","N2 EV","N2 ints-11 RNAi","TFIIS","TFIIS ints-11 RNAi"),
outline=FALSE,main="total Tm")
boxplot(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% all_detected),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"tm_downstream"],
names=c("all loci","any condition","N2 EV","N2 ints-11 RNAi","TFIIS","TFIIS ints-11 RNAi"),
outline=FALSE,main="downstream Tm")
wilcox.test(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% all_detected),"tm_downstream"])
wilcox.test(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% all_detected),"tm_downstream"])
wilcox.test(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"tm_downstream"])
wilcox.test(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"tm_downstream"])
wilcox.test(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"tm_downstream"])
wilcox.test(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"tm_downstream"])
boxplot(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% all_detected),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"tm_downstream"],
names=c("all loci","any condition","N2 EV","N2 ints-11 RNAi","TFIIS","TFIIS ints-11 RNAi"),
outline=FALSE,main="downstream Tm",las=2)
pdf("terminationsignal_strength_CAGEdetected_pis.txt")
boxplot(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% all_detected),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"tm_downstream"],
names=c("all loci","any condition","N2 EV","N2 ints-11 RNAi","TFIIS","TFIIS ints-11 RNAi"),
outline=FALSE,main="downstream Tm",las=2,ylab="termination signal strength (deltaTm)")
dev.off()
pdf("terminationsignal_strength_CAGEdetected_pis.pdf")
boxplot(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"tm_downstream"],
names=c("all loci","N2 EV","N2 ints-11 RNAi","TFIIS","TFIIS ints-11 RNAi"),
outline=FALSE,main="downstream Tm",las=2,ylab="termination signal strength (deltaTm)")
dev.off()
setwd("/Users/ab6415/Documents/Work_laptop_stuff/Bioinformatics/Analysis/INTEGRATOR_PAPER_ANALYSES/Fig5_CAGE_analyses/CAGEr_processed_tables/")
cagedata_pis<-read.table("piRNAnormalisedExpression.txt",header=TRUE)
cagedata_pis<-cagedata_pis[which(cagedata_pis$dist==2),]
library(tidyr)
library(ggplot2)
cagedata_cols<- cagedata_pis %>% spread(sample,tags)
cagedata_cols[is.na(cagedata_cols)]<-0
cagedata_pis_agg<-aggregate(cagedata_cols[,14:21],by=list(cagedata_cols[,13]),FUN=sum)
cagedata_pis[which(cagedata_pis$seqnames.start.end=="chrI,10161941,10161961"),]
cagedata_pis_agg[which(cagedata_pis_agg$Group.1=="chrI,10161941,10161961"),]
pairwise_fc<-function(df,col1,col2,pseudoTPMs){
df<-df[which((df[,col1]+df[,col2])>0),]
return(log2(df[,col2]+pseudoTPMs)-log2(df[,col1]+pseudoTPMs))
}
cagedata_pis_averaged<-data.frame(
pos=cagedata_pis_agg$Group.1,
N2_EV=0.5*cagedata_pis_agg$N2_EV1_star2+0.5*cagedata_pis_agg$N2_EV2_star2,
N2_RNAi=0.5*cagedata_pis_agg$N2_RNAi1_star2+0.5*cagedata_pis_agg$N2_RNAi2_star2,
TFIIS_EV=cagedata_pis_agg$TFIIS_EV2_star2,
TFIIS_RNAi=0.5*cagedata_pis_agg$TFIIS_RNAi1_star2+0.5*cagedata_pis_agg$TFIIS_RNAi2_star2,
total=cagedata_pis_agg$TEV_star2
)
pos_to_type_mappings<-unique(cagedata_pis[,c("name","seqnames.start.end")])
cagedata_pis_averaged_types<-merge(cagedata_pis_averaged,pos_to_type_mappings,by.x="pos",by.y="seqnames.start.end",all=TRUE)
table(cagedata_pis_averaged_types$name)
cagedata_pis_averaged_typeI<-cagedata_pis_averaged_types[which(cagedata_pis_averaged_types$name=="21UR" | cagedata_pis_averaged_types$name=="piRNA_type1"),]
cagedata_pis_averaged_typeII<-cagedata_pis_averaged_types[which(cagedata_pis_averaged_types$name=="piRNA_type2"),]
write.table(cagedata_pis_averaged_typeI,quote=FALSE,sep="\t",file = "averaged_CAGEsignal_typeIpis.txt")
format_pos<-read.table("pos_replaced_chr",header=TRUE)
cagedata_pis_averaged_typeI$chr<-format_pos$chr
cagedata_pis_averaged_typeI$st<-format_pos$st
cagedata_pis_averaged_typeI$end<-format_pos$end
cagedata_pis_averaged_typeI$chr<-as.character(cagedata_pis_averaged_typeI$chr)
cagedata_pis_averaged_typeI$st<-cagedata_pis_averaged_typeI$st-1
pi_ids<-read.table("../../Reference_annotations/all_pis_typeI.bed")
pi_ids$V1<-as.character(pi_ids$V1)
pis_cagedata_with_ID<-merge(cagedata_pis_averaged_typeI,pi_ids,by.x=c("chr","st"),by.y=c("V1","V2"),all.x=TRUE)
N2_EV<-as.character(pis_cagedata_with_ID[which(pis_cagedata_with_ID$N2_EV>0),"V4"])
N2_ints11RNAi<-as.character(pis_cagedata_with_ID[which(pis_cagedata_with_ID$N2_RNAi>0),"V4"])
TFIIS_EV<-as.character(pis_cagedata_with_ID[which(pis_cagedata_with_ID$TFIIS_EV>0),"V4"])
TFIIS_ints11RNAi<-as.character(pis_cagedata_with_ID[which(pis_cagedata_with_ID$TFIIS_RNAi>0),"V4"])
all_detected<-as.character(pis_cagedata_with_ID[,"V4"])
termination_signal_strength<-read.table("../../Reference_pausing_signal_strength/all_pis_typeI_pausingscores.bed",header=TRUE)
termination_signal_strength$V4<-as.character(termination_signal_strength$V4)
boxplot(termination_signal_strength$total,
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"total"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"total"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"total"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"total"],
names=c("all loci","N2 EV","N2 ints-11 RNAi","TFIIS","TFIIS ints-11 RNAi"),
outline=FALSE,main="total Tm")
boxplot(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"tm_downstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"tm_downstream"],
names=c("all loci","N2 EV","N2 ints-11 RNAi","TFIIS","TFIIS ints-11 RNAi"),
outline=FALSE,main="downstream Tm",las=2,ylab="termination signal strength (deltaTm)")
wilcox.test(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"tm_downstream"])
wilcox.test(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"tm_downstream"])
wilcox.test(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"tm_downstream"])
wilcox.test(termination_signal_strength$tm_downstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"tm_downstream"])
boxplot(termination_signal_strength$tm_upstream,
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_EV),"tm_upstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% N2_ints11RNAi),"tm_upstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_EV),"tm_upstream"],
termination_signal_strength[which(termination_signal_strength$V4 %in% TFIIS_ints11RNAi),"tm_upstream"],
names=c("all loci","N2 EV","N2 ints-11 RNAi","TFIIS","TFIIS ints-11 RNAi"),
outline=FALSE,main="upstream Tm")
down_bed<-read.table("all_pis_typeI_downstream50bp.bed")
down_bed
down_bed$V4<-as.character(down_bed$V4)
down_bed_detectedpis<-down_bed[which(down_bed$V4 %in% all_detected),]
down_bed_detectedpis
write.table(down_bed_detectedpis,quote = FALSE,header=FALSE,sep="\t",
file="all_pis_typeI_downstream50bp.detectedpis.bed")
down_bed_detectedpis
write.table(down_bed_detectedpis,quote = FALSE,col.names=FALSE,row.names=FALSE,sep="\t",
file="all_pis_typeI_downstream50bp.detectedpis.bed")
